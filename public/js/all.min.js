"use strict";var app=angular.module("tinkApp",["ngMaterial"]);app.controller("tinkCont",["$scope","$http",function(e,n){e.refSongs=function(){n.get("/songs/all").then(function(n){if("err"==n.data)return!1;var t=0;n.data.forEach(function(e){for(t=0;t<e.tags.length;t++)e.tags=e.tags.filter(function(e){return!!e})}),e.songs=n.data,e.filtSongs(null)})},e.refSongs(),e.reqSong=function(n){e.requesting=!0,e.currReqSong=angular.copy(n),console.log("user requests song",n)},e.cities=["Black Citadel","Lion's Arch","Rata Sum","Divinity's Reach","The Grove","Hoelbrak"],e.nct=null,e.chkAcct=function(){e.nct&&clearInterval(e.nct),e.nct=setTimeout(function(){e.nameErr=!e.currReqSong.acct.match(/\w*\.\d{4}/),e.$digest()},250)},e.doReqSong=function(){e.requesting=!1,!e.nameErr&&e.currReqSong.acct&&e.currReqSong.time?(e.currReqSong.problem=!1,e.currReqSong.msg={title:"Request sent!",body:"Your request has been sent! I'll contact you in game!"},n.post("/songs/req",e.currReqSong).then(function(e){console.log(e)})):(e.currReqSong.problem=!0,e.currReqSong.msg={title:"Problem with Request",body:"There was an issue with the request! Please double-check your info."})},e.acceptReqResult=function(){e.currReqSong.msg=null,e.currReqSong.problem?e.requesting=!0:e.currReqSong={}},e.cancelReq=function(){e.currReqSong={},e.requesting=!1},e.filtSongs=function(n){console.log("RAW SONGS",e.songs,n),n&&""!=n&&n.trim()?(console.log("filter",n),e.songsFilt=e.songs.filter(function(e){return n=n.toLowerCase(),console.log("examining song ",e),e.title&&e.title.toLowerCase().indexOf(n)>-1||e.genre&&e.genre.toLowerCase().indexOf(n)>-1||e.album&&e.album.toLowerCase().indexOf(n)>-1||e.artist&&e.artist.toLowerCase().indexOf(n)>-1||e.tags.filter(function(e){return e&&e.toLowerCase().indexOf(n)>-1}).length})):(console.log("no filter"),e.songsFilt=angular.copy(e.songs))}}]),app.controller("tinkAdmin",["$scope","$http",function(e,n){e.verifyUsr=function(){console.log("making sure user is Tink"),n.get("/chkLog").then(function(t){if(console.log("chklog response",t),e.verified=t.data,!t.data){var o=prompt("Username?",""),s=prompt("Password?","");o&&s&&""!=s&&""!=o?n.post("/login",{un:o,pw:s}).then(function(n){n.data?e.verified=!0:window.location.reload()}):(console.log("redirect to home"),alert("Missing either password or username"),window.location.assign("./"))}})},e.verifyUsr(),e.refSongs=function(){n.get("/songs/all").then(function(n){if("err"==n.data)return!1;e.songs=n.data})},e.refSongs(),e.newSong={tags:[]},e.suggested={},e.getGenres=function(t){if(!t)return e.suggested.genre=[],!1;n.get("/songs/genres/"+t).then(function(n){e.suggested.genre=n.data})},e.getArtists=function(t){if(!t)return e.suggested.artist=[],!1;n.get("/songs/artists/"+t).then(function(n){e.suggested.artist=n.data,console.log(n.data)})},e.getAlbums=function(t){if(!t)return e.suggested.album=[],!1;n.get("/songs/albums/"+t).then(function(n){e.suggested.album=n.data})},e.getTags=function(t){if(!t)return e.suggested.tags=[],!1;n.get("/songs/tags/"+t).then(function(n){e.suggested.tags=n.data})},e.acceptSug=function(n,t){e.suggested[t]=[],"tags"!=t?e.newSong[t]=n:(e.newSong.tags.push(n),e.candTag="",e.$digest())},e.noAdd=!1,e.clearSong=function(){e.newSong={tags:[]}},e.chTag=function(n,t){if(n=!!parseInt(n))e.newSong.tags.push(t);else{var o=e.newSong.tags.indexOf(t);e.newSong.tags.splice(o,1)}e.candTag=""},e.doAddSong=function(t){if(confirm("Are you sure you wish to add the song "+t.title+"?")){if(!(t.title||t.album&&t.tags.length&&t.genre&&t.tabs))return alert("Your song has too little info. Please include more!"),!1;console.log("NEW SONG",t),n.post("/songs/new",t).then(function(n){e.clearSong(),n.data&&"err"!=n.data?e.refSongs():alert("Error adding song! Sorry!")})}},e.showTabs=function(n){e.cts={title:n.title,tabs:n.tabs},e.showingTabs=!0},e.hideTabs=function(){e.showingTabs=!1,e.$digest()},e.stopProp=function(e){},e.removeSong=function(t){confirm("Are you sure you wish to remove this song?")&&n.get("/songs/rem/"+t).then(function(n){console.log("REMOVED SONG",t),e.clearSong(),e.refSongs()})},e.getReqs=function(){n.get("/songs/allReqs").then(function(n){console.log("requests",n);var t=(new Date).getTime();e.requests=n.data.filter(function(e){return new Date(e.time)>t})})},e.getReqs(),e.renderDate=function(e){return new Date(e).toLocaleString()},e.getSongId=function(n){for(var t=0;t<e.songs.length;t++)if(e.songs[t].id==n)return e.songs[t]},e.removeReq=function(t){confirm("Are you absolutely sure you wish to remove this request?")&&n.get("/songs/removeReq/"+t).then(function(n){e.getReqs()})},e.scrollTo=function(e){$("html, body").animate({scrollTop:$("#"+e).offset().top-50},200)}}]);