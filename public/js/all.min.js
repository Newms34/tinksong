"use strict";var app=angular.module("tinkApp",["ngMaterial"]);app.controller("tinkCont",["$scope","$http",function(n,e){n.refSongs=function(){e.get("/songs/all").then(function(e){if("err"==e.data)return!1;n.songs=e.data})},n.refSongs(),n.reqSong=function(e){n.requesting=!0,n.currReqSong=angular.copy(e),console.log("user requests song",e)},n.cities=["Black Citadel","Lion's Arch","Rata Sum","Divinity's Reach","The Grove","Hoelbrak"],n.nct=null,n.chkAcct=function(){n.nct&&clearInterval(n.nct),n.nct=setTimeout(function(){n.nameErr=!n.currReqSong.acct.match(/\w*\.\d{4}/),n.$digest()},250)},n.doReqSong=function(){n.requesting=!1,!n.nameErr&&n.currReqSong.acct&&n.currReqSong.time?(n.currReqSong.problem=!1,n.currReqSong.msg={title:"Request sent!",body:"Your request has been sent! I'll contact you in game!"},e.post("/songs/req",n.currReqSong).then(function(n){console.log(n)})):(n.currReqSong.problem=!0,n.currReqSong.msg={title:"Problem with Request",body:"There was an issue with the request! Please double-check your info."})},n.acceptReqResult=function(){n.currReqSong.msg=null,n.currReqSong.problem?n.requesting=!0:n.currReqSong={}},n.cancelReq=function(){n.currReqSong={},n.requesting=!1}}]),app.controller("tinkAdmin",["$scope","$http",function(n,e){n.verifyUsr=function(){console.log("making sure user is Tink"),e.get("/chkLog").then(function(t){if(console.log("chklog response",t),n.verified=t.data,!t.data){var o=prompt("Username?",""),r=prompt("Password?","");o&&r&&""!=r&&""!=o?e.post("/login",{un:o,pw:r}).then(function(e){e.data?n.verified=!0:window.location.reload()}):(console.log("redirect to home"),window.location.assign("./"))}})},n.verifyUsr(),n.refSongs=function(){e.get("/songs/all").then(function(e){if("err"==e.data)return!1;n.songs=e.data})},n.refSongs(),n.newSong={tags:[]},n.getGenres=function(n){return e.get("/songs/genres/"+n).then(function(n){return n.data})},n.getArtists=function(n){return e.get("/songs/artists/"+n).then(function(n){return n.data})},n.getAlbums=function(n){return e.get("/songs/albums/"+n).then(function(n){return n.data})},n.getTags=function(n){return e.get("/songs/tags/"+n).then(function(n){return n.data})},n.noAdd=!1,n.clearSong=function(){n.newSong={tags:[]}},n.chTag=function(e,t){if(e=!!parseInt(e))n.newSong.tags.push(t);else{var o=n.newSong.tags.indexOf(t);n.newSong.tags.splice(o,1)}n.newTag=""},n.doAddSong=function(t){if(confirm("Are you sure you wish to add the song "+t.title+"?")){if(!(t.title||t.album&&t.tags.length&&t.genre))return alert("Your song has too little info. Please include more!"),!1;e.post("/songs/new",t).then(function(e){n.clearSong(),e.data?n.refSongs():alert("Error adding song! Sorry!")})}},n.removeSong=function(t){confirm("Are you sure you wish to remove this song?")&&e.get("/songs/rem/"+t).then(function(e){console.log("REMOVED SONG",t),n.clearSong(),n.refSongs()})}}]);